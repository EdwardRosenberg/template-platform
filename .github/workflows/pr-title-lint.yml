name: PR Title Lint

on:
  workflow_call:
  pull_request:
    types:
      - opened
      - edited
      - synchronize
      - reopened

permissions:
  pull-requests: read

jobs:
  pr-title-lint:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title format
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "Validating PR title: $PR_TITLE"
          
          # Conventional Commits regex pattern
          # Format: <type>(<optional scope>)<optional !>: <description>
          # Valid types: feat, fix, chore, docs, refactor, test, perf, ci, build
          PATTERN='^(feat|fix|chore|docs|refactor|test|perf|ci|build)(\(.+\))?(!)?: .+'
          
          if echo "$PR_TITLE" | grep -Pq "$PATTERN"; then
            echo "✅ PR title follows Conventional Commits format"
            exit 0
          else
            echo "❌ PR title does not follow Conventional Commits format"
            echo ""
            echo "Expected format: <type>(<optional scope>)<optional !>: <description>"
            echo ""
            echo "Valid types: feat, fix, chore, docs, refactor, test, perf, ci, build"
            echo ""
            echo "Examples:"
            echo "  ✅ feat: add user authentication"
            echo "  ✅ fix(api): correct null pointer exception"
            echo "  ✅ chore!: update dependencies (breaking change)"
            echo "  ✅ docs: update README"
            echo ""
            echo "Your PR title: $PR_TITLE"
            echo ""
            echo "See docs/pr-title-guidelines.md for detailed guidance."
            exit 1
          fi
